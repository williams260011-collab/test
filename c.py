import re
import json
from urllib.parse import parse_qs, unquote

def parse_curl_extract_body(curl_cmd):
    try:
        # ========== 核心修复：预处理curl，移除Windows CMD的^转义符 ==========
        curl_cmd = curl_cmd.replace("^", "")
        # ====================================================================

        # 正则匹配规则：兼容 -d/--data/--data-raw，单/双引号包裹的内容，忽略换行/空格
        pattern = re.compile(r'(-d|--data|--data-raw)\s*([\'"])(.*?)\2', re.DOTALL | re.IGNORECASE)
        # 查找所有匹配的body片段（curl多-d会自动拼接，这里也做拼接）
        matches = pattern.findall(curl_cmd)
        if not matches:
            return None

        # 拼接多-d/--data-raw的内容，去除无用的空白符
        body_str = ''.join([match[2].strip() for match in matches])
        # 解码百分号编码
        body_str = unquote(body_str)
        # 还原curl里的转义符（\"→"、\'→'等，适配常见转义）
        body_str = body_str.replace('\\"', '"').replace("\\'", "'").replace('\\n', '').replace('\\r', '')

        # 自动判断格式并解析：JSON格式（{}包裹）→ 字典；表单格式→字典
        if body_str.strip().startswith('{') and body_str.strip().endswith('}'):
            # JSON格式解析
            return json.loads(body_str)
        else:
            # 表单格式（x-www-form-urlencoded）解析，处理多值情况取第一个
            form_data = parse_qs(body_str)
            return {k: v[0] if len(v) == 1 else v for k, v in form_data.items()}
    except json.JSONDecodeError:
        return f"JSON格式解析失败，原始body内容：{body_str}"
    except Exception as e:
        return f"解析失败：{str(e)}，原始body内容：{body_str}"
if __name__ == '__main__':
    # 你的实际curl命令（Windows CMD格式，带^转义符）
    curl_cmd = r'''
    curl ^"https://collector.github.com/github/collect^" ^
  -H ^"accept: */*^" ^
  -H ^"accept-language: zh-CN,zh;q=0.9^" ^
  -H ^"content-type: text/plain;charset=UTF-8^" ^
  -b ^"_octo=GH1.1.1307840573.1764578965; GHCC=Required:1-Analytics:1-SocialMedia:1-Advertising:1; logged_in=yes; dotcom_user=williams260011-collab; color_mode=^%^7B^%^22color_mode^%^22^%^3A^%^22auto^%^22^%^2C^%^22light_theme^%^22^%^3A^%^7B^%^22name^%^22^%^3A^%^22light^%^22^%^2C^%^22color_mode^%^22^%^3A^%^22light^%^22^%^7D^%^2C^%^22dark_theme^%^22^%^3A^%^7B^%^22name^%^22^%^3A^%^22dark^%^22^%^2C^%^22color_mode^%^22^%^3A^%^22dark^%^22^%^7D^%^7D; cpu_bucket=xlg; preferred_color_mode=light; tz=Asia^%^2FShanghai^" ^
  -H ^"origin: https://github.com^" ^
  -H ^"priority: u=4, i^" ^
  -H ^"referer: https://github.com/williams260011-collab^" ^
  -H ^"sec-ch-ua: ^\^"Not(A:Brand^\^";v=^\^"8^\^", ^\^"Chromium^\^";v=^\^"144^\^", ^\^"Google Chrome^\^";v=^\^"144^\^"^" ^
  -H ^"sec-ch-ua-mobile: ?0^" ^
  -H ^"sec-ch-ua-platform: ^\^"Windows^\^"^" ^
  -H ^"sec-fetch-dest: empty^" ^
  -H ^"sec-fetch-mode: no-cors^" ^
  -H ^"sec-fetch-site: same-site^" ^
  -H ^"user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36^" ^
  --data-raw ^"^{^\^"client_id^\^":^\^"1307840573.1764578965^\^",^\^"events^\^":^[^{^\^"page^\^":^\^"https://github.com/williams260011-collab^\^",^\^"title^\^":^\^"williams260011-collab (DYix)^\^",^\^"context^\^":^{^\^"actor_id^\^":^\^"253665900^\^",^\^"actor_login^\^":^\^"williams260011-collab^\^",^\^"actor_hash^\^":^\^"9d480051611bfbf90e694c70178d118b7a4063408473dd513908d3d70def104f^\^",^\^"user_id^\^":^\^"253665900^\^",^\^"user_login^\^":^\^"williams260011-collab^\^",^\^"referrer^\^":^\^"https://github.com/ashphy/jsonpath-online-evaluator^\^",^\^"request_id^\^":^\^"E940:7CA80:71508:92CC2:6981DA63^\^",^\^"visitor_id^\^":^\^"5617132491181479573^\^",^\^"region_edge^\^":^\^"iad^\^",^\^"region_render^\^":^\^"iad^\^",^\^"staff^\^":^\^"false^\^",^\^"react^\^":^\^"false^\^",^\^"reactPartials^\^":^\^"^[^\^\^\^"keyboard-shortcuts-dialog^\^\^\^",^\^\^\^"global-nav-bar^\^\^\^",^\^\^\^"user-status-dialog^\^\^\^"^]^\^",^\^"featureFlags^\^":^\^"^[^\^\^\^"a11y_status_checks_ruleset^\^\^\^",^\^\^\^"action_yml_language_service^\^\^\^",^\^\^\^"actions_custom_images_public_preview_visibility^\^\^\^",^\^\^\^"actions_custom_images_storage_billing_ui_visibility^\^\^\^",^\^\^\^"actions_enable_snapshot_keyword^\^\^\^",^\^\^\^"actions_image_version_event^\^\^\^",^\^\^\^"actions_workflow_language_service^\^\^\^",^\^\^\^"actions_workflow_language_service_allow_case_function^\^\^\^",^\^\^\^"agent_session_retry_fetch_capi_on_401^\^\^\^",^\^\^\^"alternate_user_config_repo^\^\^\^",^\^\^\^"api_insights_show_missing_data_banner^\^\^\^",^\^\^\^"arianotify_comprehensive_migration^\^\^\^",^\^\^\^"billing_hard_budget_limits_for_licenses^\^\^\^",^\^\^\^"billing_ui_budget_pagination_enabled^\^\^\^",^\^\^\^"codespaces_prebuild_region_target_update^\^\^\^",^\^\^\^"coding_agent_model_selection^\^\^\^",^\^\^\^"contentful_lp_footnotes^\^\^\^",^\^\^\^"copilot_3p_agent_hovercards^\^\^\^",^\^\^\^"copilot_agent_sessions_alive_updates^\^\^\^",^\^\^\^"copilot_agent_task_list_v2^\^\^\^",^\^\^\^"copilot_agent_task_submit_with_modifier^\^\^\^",^\^\^\^"copilot_agent_tasks_btn_code_nav^\^\^\^",^\^\^\^"copilot_agent_tasks_btn_code_view^\^\^\^",^\^\^\^"copilot_agent_tasks_btn_code_view_lines^\^\^\^",^\^\^\^"copilot_agent_tasks_btn_repo^\^\^\^",^\^\^\^"copilot_agents_blankslate_mem_requests^\^\^\^",^\^\^\^"copilot_api_agentic_issue_marshal_yaml^\^\^\^",^\^\^\^"copilot_ask_mode_dropdown^\^\^\^",^\^\^\^"copilot_capi_error_response_telemetry^\^\^\^",^\^\^\^"copilot_chat_agents_empty_state^\^\^\^",^\^\^\^"copilot_chat_attach_multiple_images^\^\^\^",^\^\^\^"copilot_chat_clear_model_selection_for_default_change^\^\^\^",^\^\^\^"copilot_chat_disable_model_picker_while_streaming^\^\^\^",^\^\^\^"copilot_chat_file_redirect^\^\^\^",^\^\^\^"copilot_chat_input_commands^\^\^\^",^\^\^\^"copilot_chat_opening_thread_switch^\^\^\^",^\^\^\^"copilot_chat_reduce_quota_checks^\^\^\^",^\^\^\^"copilot_chat_search_bar_redirect^\^\^\^",^\^\^\^"copilot_chat_selection_attachments^\^\^\^",^\^\^\^"copilot_chat_vision_in_claude^\^\^\^",^\^\^\^"copilot_chat_vision_preview_gate^\^\^\^",^\^\^\^"copilot_coding_agent_task_response^\^\^\^",^\^\^\^"copilot_custom_copilots^\^\^\^",^\^\^\^"copilot_custom_copilots_feature_preview^\^\^\^",^\^\^\^"copilot_duplicate_thread^\^\^\^",^\^\^\^"copilot_extensions_hide_in_dotcom_chat^\^\^\^",^\^\^\^"copilot_extensions_removal_on_marketplace^\^\^\^",^\^\^\^"copilot_features_raycast_logo^\^\^\^",^\^\^\^"copilot_features_sql_server_logo^\^\^\^",^\^\^\^"copilot_features_zed_logo^\^\^\^",^\^\^\^"copilot_file_block_ref_matching^\^\^\^",^\^\^\^"copilot_ftp_hyperspace_upgrade_prompt^\^\^\^",^\^\^\^"copilot_icebreakers_experiment_dashboard^\^\^\^",^\^\^\^"copilot_icebreakers_experiment_hyperspace^\^\^\^",^\^\^\^"copilot_immersive_job_result_preview^\^\^\^",^\^\^\^"copilot_immersive_structured_model_picker^\^\^\^",^\^\^\^"copilot_immersive_task_hyperlinking^\^\^\^",^\^\^\^"copilot_immersive_task_within_chat_thread^\^\^\^",^\^\^\^"copilot_issue_list_show_more^\^\^\^",^\^\^\^"copilot_mc_cli_resume_any_users_task^\^\^\^",^\^\^\^"copilot_org_policy_page_focus_mode^\^\^\^",^\^\^\^"copilot_pipes_code_nodes^\^\^\^",^\^\^\^"copilot_pipes_github_graphql_nodes^\^\^\^",^\^\^\^"copilot_premium_request_quotas^\^\^\^",^\^\^\^"copilot_redirect_header_button_to_agents^\^\^\^",^\^\^\^"copilot_security_alert_assignee_options^\^\^\^",^\^\^\^"copilot_share_active_subthread^\^\^\^",^\^\^\^"copilot_spaces_ga^\^\^\^",^\^\^\^"copilot_spaces_individual_policies_ga^\^\^\^",^\^\^\^"copilot_spaces_pagination^\^\^\^",^\^\^\^"copilot_spark_empty_state^\^\^\^",^\^\^\^"copilot_spark_handle_nil_friendly_name^\^\^\^",^\^\^\^"copilot_stable_conversation_view^\^\^\^",^\^\^\^"copilot_swe_agent_progress_commands^\^\^\^",^\^\^\^"copilot_swe_agent_use_subagents^\^\^\^",^\^\^\^"copilot_unconfigured_is_inherited^\^\^\^",^\^\^\^"custom_instructions_file_references^\^\^\^",^\^\^\^"custom_properties_consolidate_default_value_input^\^\^\^",^\^\^\^"dashboard_lists_max_age_filter^\^\^\^",^\^\^\^"dashboard_universe_2025^\^\^\^",^\^\^\^"dashboard_universe_2025_feedback_dialog^\^\^\^",^\^\^\^"dom_node_counts^\^\^\^",^\^\^\^"enterprise_ai_controls^\^\^\^",^\^\^\^"failbot_report_error_react_apps_on_page^\^\^\^",^\^\^\^"fgpat_permissions_selector_redesign^\^\^\^",^\^\^\^"flex_cta_groups_mvp^\^\^\^",^\^\^\^"github_models_scheduled_hydro_events^\^\^\^",^\^\^\^"global_nav_react^\^\^\^",^\^\^\^"hide_groups_list_for_few_groups^\^\^\^",^\^\^\^"hyperspace_2025_logged_out_batch_1^\^\^\^",^\^\^\^"hyperspace_2025_logged_out_batch_2^\^\^\^",^\^\^\^"initial_per_page_pagination_updates^\^\^\^",^\^\^\^"issue_fields_compact_view^\^\^\^",^\^\^\^"issue_fields_global_search^\^\^\^",^\^\^\^"issue_fields_report_usage^\^\^\^",^\^\^\^"issue_fields_timeline_events^\^\^\^",^\^\^\^"issues_cca_assign_actor_with_agent^\^\^\^",^\^\^\^"issues_default_best_match_sort^\^\^\^",^\^\^\^"issues_expanded_file_types^\^\^\^",^\^\^\^"issues_index_semantic_search^\^\^\^",^\^\^\^"issues_lazy_load_comment_box_suggestions^\^\^\^",^\^\^\^"issues_react_auto_retry_on_error^\^\^\^",^\^\^\^"issues_react_bots_timeline_pagination^\^\^\^",^\^\^\^"issues_react_chrome_container_query_fix^\^\^\^",^\^\^\^"issues_react_custom_hpc_metric^\^\^\^",^\^\^\^"issues_react_include_bots_in_pickers^\^\^\^",^\^\^\^"issues_react_prohibit_title_fallback^\^\^\^",^\^\^\^"issues_react_safari_scroll_preservation^\^\^\^",^\^\^\^"issues_react_ui_feedback^\^\^\^",^\^\^\^"issues_react_use_turbo_for_cross_repo_navigation^\^\^\^",^\^\^\^"issues_report_sidebar_interactions^\^\^\^",^\^\^\^"landing_pages_ninetailed^\^\^\^",^\^\^\^"lifecycle_label_name_updates^\^\^\^",^\^\^\^"loops_service_graphql_execution^\^\^\^",^\^\^\^"marketing_pages_search_explore_provider^\^\^\^",^\^\^\^"memex_default_issue_create_repository^\^\^\^",^\^\^\^"memex_display_button_config_menu^\^\^\^",^\^\^\^"memex_grouped_by_edit_route^\^\^\^",^\^\^\^"memex_live_update_hovercard^\^\^\^",^\^\^\^"memex_mwl_filter_field_delimiter^\^\^\^",^\^\^\^"memex_roadmap_drag_style^\^\^\^",^\^\^\^"mission_control_retry_on_401^\^\^\^",^\^\^\^"mission_control_use_body_html^\^\^\^",^\^\^\^"open_agent_session_in_vscode_insiders^\^\^\^",^\^\^\^"open_agent_session_in_vscode_stable^\^\^\^",^\^\^\^"pr_sfv_new_diff_fetch^\^\^\^",^\^\^\^"pr_simple_diffs^\^\^\^",^\^\^\^"primer_react_css_has_selector_perf^\^\^\^",^\^\^\^"projects_assignee_max_limit^\^\^\^",^\^\^\^"pull_request_files_accurate_size_estimates^\^\^\^",^\^\^\^"pull_request_files_virtualization^\^\^\^",^\^\^\^"react_quality_profiling^\^\^\^",^\^\^\^"repo_picker_client_caching^\^\^\^",^\^\^\^"repos_insights_remove_new_url^\^\^\^",^\^\^\^"repository_suggester_elastic_search^\^\^\^",^\^\^\^"ruleset_deletion_confirmation^\^\^\^",^\^\^\^"sample_network_conn_type^\^\^\^",^\^\^\^"session_logs_ungroup_reasoning_text^\^\^\^",^\^\^\^"site_calculator_actions_2025^\^\^\^",^\^\^\^"site_features_copilot_universe^\^\^\^",^\^\^\^"site_homepage_collaborate_video^\^\^\^",^\^\^\^"spark_prompt_secret_scanning^\^\^\^",^\^\^\^"spark_server_connection_status^\^\^\^",^\^\^\^"suppress_automated_browser_vitals^\^\^\^",^\^\^\^"suppress_non_representative_vitals^\^\^\^",^\^\^\^"swe_agent_member_requests^\^\^\^",^\^\^\^"swe_agent_member_requests_agent_panel^\^\^\^",^\^\^\^"viewscreen_sandbox^\^\^\^",^\^\^\^"webp_support^\^\^\^",^\^\^\^"workbench_store_readonly^\^\^\^"^]^\^",^\^"ssr^\^":^\^"false^\^",^\^"controller^\^":^\^"^\^\^\^"profiles^\^\^\^"^\^",^\^"action^\^":^\^"^\^\^\^"show^\^\^\^"^\^",^\^"routePattern^\^":^\^"^\^\^\^"/:user_id(.:format)^\^\^\^"^\^",^\^"cpu^\^":^\^"^\^\^\^"xlg^\^\^\^"^\^",^\^"longAnimationFrames^\^":^\^"^[^{^\^\^\^"name^\^\^\^":^\^\^\^"long-animation-frame^\^\^\^",^\^\^\^"entryType^\^\^\^":^\^\^\^"long-animation-frame^\^\^\^",^\^\^\^"startTime^\^\^\^":86252.30000019073,^\^\^\^"duration^\^\^\^":84.5,^\^\^\^"renderStart^\^\^\^":86332,^\^\^\^"styleAndLayoutStart^\^\^\^":86336,^\^\^\^"firstUIEventTimestamp^\^\^\^":86265.89999961853,^\^\^\^"blockingDuration^\^\^\^":0,^\^\^\^"scripts^\^\^\^":^[^{^\^\^\^"name^\^\^\^":^\^\^\^"script^\^\^\^",^\^\^\^"entryType^\^\^\^":^\^\^\^"script^\^\^\^",^\^\^\^"startTime^\^\^\^":86261.19999980927,^\^\^\^"duration^\^\^\^":39,^\^\^\^"invoker^\^\^\^":^\^\^\^"Response.text.then^\^\^\^",^\^\^\^"invokerType^\^\^\^":^\^\^\^"resolve-promise^\^\^\^",^\^\^\^"windowAttribution^\^\^\^":^\^\^\^"self^\^\^\^",^\^\^\^"executionStart^\^\^\^":86261.19999980927,^\^\^\^"forcedStyleAndLayoutDuration^\^\^\^":18,^\^\^\^"pauseDuration^\^\^\^":0,^\^\^\^"sourceURL^\^\^\^":^\^\^\^"https://github.githubassets.com/assets/70191-2ff8c1780a1e.js^\^\^\^",^\^\^\^"sourceFunctionName^\^\^\^":^\^\^\^"^\^\^\^",^\^\^\^"sourceCharPosition^\^\^\^":-1^}^]^}^]^\^"^},^\^"type^\^":^\^"web-vital^\^"^}^],^\^"request_context^\^":^{^\^"referrer^\^":^\^"https://jsonpath.com/^\^",^\^"user_agent^\^":^\^"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36^\^",^\^"screen_resolution^\^":^\^"2048x1153^\^",^\^"browser_resolution^\^":^\^"2048x452^\^",^\^"browser_languages^\^":^\^"zh-CN,zh^\^",^\^"pixel_ratio^\^":1.25,^\^"timestamp^\^":1770117759499,^\^"tz_seconds^\^":28800^}^}^"
    '''

    # 解析并打印结果
    print("===== 解析Windows CMD格式curl（--data-raw 表单格式） =====")
    body_params = parse_curl_extract_body(curl_cmd)
    print(f"提取的Body参数字典：{body_params}")
    if isinstance(body_params, dict):
        # 按需获取单个参数
        print(f"单独获取currentPage：{body_params.get('currentPage')}")
        print(f"单独获取pageSize：{body_params.get('pageSize')}")